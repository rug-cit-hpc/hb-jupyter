<%-
    paths = []
    paths << Pathname.new("/home/#{User.new.name}")
    paths << Pathname.new("/data/#{User.new.name}")
    paths << Pathname.new("/scratch/#{User.new.name}")

    projects = User.new.groups.map(&:name).grep(/^pg-./)

    paths.concat projects.map { |p| Pathname.new("/data/#{p}")  }
-%>

---
cluster: "peregrine"

form:
  - node_type
  - version
  - walltime
  - num_cores
  - memory
  - start_folder
  - pg_email_on_started
  - pg_email_user

attributes:
  node_type:
    label: Node Type
    help: |
      Select the type of node you would like to use. For information on the different options, please see 
      [our wiki](https://wiki.hpc.rug.nl/peregrine/introduction/cluster_description#compute_nodes)
    widget: select
    options:
      - [ "Regular", "regular" ]
      - [ "Himem", "himem" ]
      - [ "GPU (K40)", "gpuk40" ]
      - [ "GPU (V100)", "gpuv100" ]
      - [ "GELIFES", "gelifes" ]

  version:
    widget: "select"
    label: "Python Version"
    help: |
      Select one of the Python versions from the dropdown.
    options:
    #   - [   "Python 3.6.4", "IPython/6.4.0-foss-2018a-Python-3.6.4" ]
      - [   "Python 3.6.6 (GPU)", "IPython/7.2.0-fosscuda-2018b-Python-3.6.6", 
            data-option-for-node-type-regular: false, 
            data-option-for-node-type-himem: false, 
            data-option-for-node-type-gelifes: false
        ]
      - [   "Python 3.7.2", "IPython/7.7.0-foss-2019a-Python-3.7.2",
            data-option-for-node-type-gpuk40: false, 
            data-option-for-node-type-gpuv100: false
        ]
      - [   "Python 3.7.2 (GPU)", "IPython/7.7.0-fosscuda-2019a-Python-3.7.2",
            data-option-for-node-type-regular: false, 
            data-option-for-node-type-himem: false, 
            data-option-for-node-type-gelifes: false
        ]
      - [   "Python 3.7.4", "IPython/7.9.0-foss-2019b-Python-3.7.4",
            data-option-for-node-type-gpuk40: false, 
            data-option-for-node-type-gpuv100: false
        ]
      - [   "Python 3.7.4 (GPU)", "IPython/7.9.0-fosscuda-2019b-Python-3.7.4",
            data-option-for-node-type-regular: false, 
            data-option-for-node-type-himem: false, 
            data-option-for-node-type-gelifes: false
        ]
      - [   "Python 3.8.2", "IPython/7.15.0-foss-2020a-Python-3.8.2",
            data-option-for-node-type-gpuk40: false, 
            data-option-for-node-type-gpuv100: false
        ]
      - [   "Python 3.8.2 (GPU)", "IPython/7.15.0-foss-2020a-Python-3.8.2 CUDA/11.4.1",
            data-option-for-node-type-regular: false, 
            data-option-for-node-type-himem: false, 
            data-option-for-node-type-gelifes: false
        ]
      - [   "Python 3.9.5", "IPython/7.25.0-GCCcore-10.3.0",
            data-option-for-node-type-gpuk40: false, 
            data-option-for-node-type-gpuv100: false
        ]
      - [   "Python 3.9.5 (GPU)", "IPython/7.25.0-GCCcore-10.3.0 CUDA/11.4.1",
            data-option-for-node-type-regular: false, 
            data-option-for-node-type-himem: false, 
            data-option-for-node-type-gelifes: false
        ]
#      - [   "R 3.6.1", "R/3.6.1-foss-2018a IPython/6.4.0-foss-2018a-Python-3.6.4 Pandoc/2.5" ]
#      - [   "R 4.1.0", "R/4.1.0-foss-2021a IPython/7.25.0-GCCcore-10.3.0" ]

  walltime:
    label: Wall time
    help: "Please give the wall time in the SLURM format, D-HH:MM:SS"
    widget: "text_field"

  memory:
    label: Memory
    help: Amount of memory requested, in GB
    widget: 'number_field'
    value: 2
    min: 1
    step: 1

  start_folder:
    label: Notebook root folder
    help: Where should the jupyter server start?
  <%- if paths.blank? -%>
    widget: text_field
  <%- else -%>
    widget: select
    options:
    <%- paths.each do |q| -%>
      - [ "<%= q %>", "<%= q %>" ]
    <%- end -%>
  <%- end -%>

  num_cores:
    widget: number_field
    label: Number of CPU cores
    value: 1
    id: 'num_cores'
    help: |
      Select the number of CPU cores.
    min: 1
    step: 1

  pg_email_on_started:
    label: "Email notification"
    help: |
      Would you like to be notified via email when your session starts?
    widget: "select"
    options:
      - ["No", "no", data-hide-pg-email-user: true]
      - ["Yes", "yes"]

  pg_email_user:
    label: Email
    help: "Your email for notifications"
    widget: "text_field"
